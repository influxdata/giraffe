# Giraffe

A React-based visualization library powering the data visualizations in [InfluxDB 2.0](https://github.com/influxdata/influxdb/) UI.

## Quick Start

1. In your React code, import the `Plot` component and the `newTable` utility function

```
import {Plot, newTable} from '@influxdata/giraffe'
```

2. Build the config object.  
   a. **Required properties**:

   - `table` is data built using the newTable utilty function or built from Flux results, _see_ [Flux example](./README.md#example-using-flux)
   - `layers` is an array of objects that describe how to render the data.

   b. _Optional properties_ include customizations for

   - gridlines: color and opacity
   - axes: appearance, color, opacity, and scaling
   - ticks: generation, formatting and labeling, font, and color
   - legend (tooltip): labeling and styling

   For details on all configuration properties, skip to [config](#Config) documentation.

Here is an example of building the config object while skipping optional properties:

```
// Example table and layer

const table = newTable(5)
  .addColumn('_time', 'time', [1589838401244, 1589838461244, 1589838521244, 1589838581244, 1589838641244])
  .addColumn('_value', 'number', [2.58, 7.11, 4.79, 8.89, 2.23])

const lineLayer = {
  type: "line",
  x: "_time",
  y: "_value",
}

const config = {
  table: table,
  layers: [lineLayer],
}
```

3. Render your component by passing the `confg` object as the config prop to the `<Plot>` component. Be sure that the parent component around `<Plot>` has both a height and a width measured in positive values. If either is not a positive value, the graph will not be visible.

   For example, to make a `<Plot>` that adjusts to screen height and width, in your React rendering code return this element:

```
  // return this element in your React rendering code:

  <div
    style={{
      width: "calc(70vw - 20px)",
      height: "calc(70vh - 20px)",
      margin: "40px",
    }}
  >
    <Plot config={config} />
  </div>
```

## Example Using Flux [](#example-using-flux)

When generating the table through a Flux result:

- call the `fromFlux` utility function on the csv that is generated by Flux
- get the table in the returned object from calling `fromFlux`

Here is an example of turning a result in comma separate values (CSV) from Flux into a table and rendering it without optional properties:

```
  import {Plot, fromFlux} from '@influxdata/giraffe'

  // ...

  const fluxResultCSV = `#datatype,string,long,dateTime:RFC3339,dateTime:RFC3339,dateTime:RFC3339,double,string,string,string,string
#group,false,false,true,true,false,false,true,true,true,true
#default,_result,,,,,,,,,
,result,table,_start,_stop,_time,_value,_field,_measurement,example,location
,,0,2020-03-25T20:58:15.731129Z,2020-04-24T20:58:15.731129Z,2020-04-03T18:31:33.95Z,29.9,value,temperature,index.html,browser
,,0,2020-03-25T20:58:15.731129Z,2020-04-24T20:58:15.731129Z,2020-04-03T18:55:23.863Z,28.7,value,temperature,index.html,browser
,,0,2020-03-25T20:58:15.731129Z,2020-04-24T20:58:15.731129Z,2020-04-03T19:50:52.357Z,15,value,temperature,index.html,browser
,,0,2020-03-25T20:58:15.731129Z,2020-04-24T20:58:15.731129Z,2020-04-03T19:53:37.198Z,24.8,value,temperature,index.html,browser
,,0,2020-03-25T20:58:15.731129Z,2020-04-24T20:58:15.731129Z,2020-04-03T19:53:53.033Z,23,value,temperature,index.html,browser
,,0,2020-03-25T20:58:15.731129Z,2020-04-24T20:58:15.731129Z,2020-04-03T20:19:21.88Z,20.1,value,temperature,index.html,browser
,,0,2020-03-25T20:58:15.731129Z,2020-04-24T20:58:15.731129Z,2020-04-10T22:20:40.776Z,28.7,value,temperature,index.html,browser
`

  const dataFromFlux = fromFlux(fluxResultCSV)

  const lineLayer = {
    type: "line",
    x: "_time",
    y: "_value",
  }

  const config = {
    table: dataFromFlux.table,
    layers: [lineLayer],
  }

  // ...

  // return this element in your React rendering code:

  <div
    style={{
      width: "calc(70vw - 20px)",
      height: "calc(70vh - 20px)",
      margin: "40px",
    }}
  >
    <Plot config={config} />
  </div>
```

## Config

`<Plot>` requires a `config` prop which is an object with properties that serve three purposes:

- customizing the [appearance](#appearance-properties) of `<Plot>`
- specifying the [data](#data-properties) to be visualized
- defining the columns and appearance of the [legend (tooltip)](#legend-tooltip-properties).

<pre>
  const config = {
    <b><i>property</i></b>: <b><i>value</i></b>,
    <b><i>...</i></b>
  }
</pre>

### Appearance properties

- **width**: _number. Optional._ The width in _CSS px_ of the Plot. Includes the space to the left and below the axes surrounding the ticks, tick labels, and axis labels. When not specified, the width of the parent element to `<Plot>` will determine.

- **height**: _number. Optional._ The height in _CSS px_ of the Plot. Includes the space to the left and below the axes surrounding the ticks, tick labels, and axis labels. When not specified, the height of the parent element to `<Plot>` will determine.

- **gridColor**: _string. Optional._ The _CSS color value_ of the grid lines. Applies to the inner horizontal and vertical rule lines. Excludes the axes and the border around the graph.

- **gridOpacity**: _number. Optional. Recommendation: do not include. Defaults to 1 when excluded._ A value between 0 and 1 for the [_CanvasRenderingContext2D globalAlpha_](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalAlpha) of the grid lines. Applies to the inner horizontal and vertical rule lines. Excludes the axes and the border around the graph.

- **showAxes**: _boolean. Optional. Recommendation: do not include. Defaults to true when excluded._ Indicates whether Plot axes should be visible. Applies to both x-axis and y-axis simultaneously.

- **axisColor**: _string. Optional._ The _CSS color value_ of the axes and the border around the graph. Excludes the inner horizontal and vertical rule lines.

- **axisOpacity**: _number. Optional. Recommendation: do not include. Defaults to 1 when excluded._ A value between 0 and 1 for the [_CanvasRenderingContext2D globalAlpha_](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalAlpha) of the axes and the border around the graph. Excludes the inner horizontal and vertical rule lines.

- **xTicks**: _array[number, ...]. Optional._ An array of values representing tick marks on the x-axis. Actual data values and axis scaling may cause Plot to not render all of the given ticks, or Plot rendering may extend beyond all of the rendered ticks.

- **yTicks**: _array[number, ...]. Optional._ An array of values representing tick marks on the y-axis. Actual data values and axis scaling may cause Plot to not render all of the given ticks, or Plot rendering may extend beyond all of the rendered ticks.

- **tickFont**: _string. Optional._ The [_CSS font_](https://developer.mozilla.org/en-US/docs/Web/CSS/font) value for the styling of the tick labels and axis labels.

- **tickFontColor**: _string. Optional._ The _CSS color value_ of the tick labels and axis labels.

- **valueFormatters**: _object. Optional._ An object containing column keys and their corresponding functions that format data for that column type. Each function takes a data value as the first argument, and an optional second argument as an options object. Returns a formatted string for that data value. For example:

```
const config = {
  // ...

  valueFormatters: {
    _time: (t) => new Date(t).toLocaleTimeString(),  // ECMAScript time to human-readable time stamp
    _value: (num) => num.toFixed(2),                 // values fixed to 2 decimal places
  },

  // ...
}
```

- **xAxisLabel**: _string. Optional._ Uses **tickFont**, **tickFontColor**. Name to display below the x-axis.

- **yAxisLabel**: _string. Optional._ Uses **tickFont**, **tickFontColor**. Name to display to the left of the y-axis.

### Data properties

- **table**: _Object. **Required**._

- **layers**: _array[Object, ...]. **Required**._

- **xScale**: _"linear" | "log". Optional._ Sets the scaling of the x-axis. Linear scaling means the same distance between ticks represent the same increase in value. Logarithmic (log) scaling means the same distance between ticks can represent an exponential increase in value, used as a way to display data with a very wide range of values in a compact space.

- **yScale**: _"linear" | "log". Optional._ Sets the scaling of the y-axis. Linear scaling means the same distance between ticks represent the same increase in value. Logarithmic (log) scaling means the same distance between ticks can represent an exponential increase in value, used as a way to display data with a very wide range of values in a compact space.

- **xDomain**: _array[min, max]. Optional._ The x domain of the plot can be explicitly set with numbers denoting a _min_ and _max_. If this option is passed, then `<Plot>` is operating in a "controlled" mode, where it always uses the passed x domain. Any brush interaction with the `<Plot>` that should change the x domain will call the `onSetXDomain` option when the component is in controlled mode. Double clicking the plot will call `onResetXDomain`. If the `xDomain` option is not passed, then the component is "uncontrolled". It will compute, set, and reset the `xDomain` automatically.

- **onSetXDomain**: _function. Optional._ See above regarding **xDomain**.

- **onResetXDomain**: _function. Optional._ See above regarding **xDomain**.

- **yDomain**: _array[min, max]. Optional._ The y domain of the plot can be explicitly set with numbers denoting a _min_ and _max_. If this option is passed, then `<Plot>` is operating in a "controlled" mode, where it always uses the passed y domain. Any brush interaction with the `<Plot>` that should change the y domain will call the `onSetYDomain` option when the component is in controlled mode. Double clicking the plot will call `onResetYDomain`. If the `yDomain` option is not passed, then the component is "uncontrolled". It will compute, set, and reset the `yDomain` automatically.

- **onSetYDomain**: _function. Optional._ See above regarding **yDomain**.

- **onResetYDomain**: _function. Optional._ See above regarding **yDomain**.

### Legend Tooltip properties

- **legendFont**: _string. Optional._ The [_CSS font_](https://developer.mozilla.org/en-US/docs/Web/CSS/font) value for the styling of the legend (tooltip).

- **legendFontColor**: _string. Optional._ The _CSS color value_ of the column headers in the legend (tooltip). The rest of the legend will use the color scheme set by the `LayerConfig`'s `colors` options.

- **legendFontBrightColor**: _string. Optional. Recommendation: do not include._ The _CSS color value_ of any text that is not a column header or in a row inside the legend (tooltip). Currently no such text exists and may be added in the future.

- **legendBackgroundColor**: _string. Optional._ The _CSS color value_ of the background in the legend (tooltip).

- **legendBorder**: _string. Optional._ The [_CSS border_](https://developer.mozilla.org/en-US/docs/Web/CSS/border) value for the styling of the border around the legend (tooltip).

- **legendCrosshairColor**: _string | Object. Optional._ The _CSS color value_ or styling of the vertical crosshair line through the Plot at where the mouse is hovering, defined as a [_CanvasRenderingContext2D strokeStyle_](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/strokeStyle).

- **legendColumns**: _array[string, ...]. Optional_. When included, this array will determine which column key names that should be included in the legend (tooltip). If this option is included as an empty array, the legend will be empty.
